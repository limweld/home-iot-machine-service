pipeline {
	agent any
	environment {
		ENV="DEV"
		PROJECT_NAME="home-iot-machine-load-test"
	}
	stages {
		stage('Load Testing') {
			steps{
				bat 'jmeter -Jjmeter.save.saveservice.output_format=xml -n -t .jmeter//%PROJECT_NAME%.jmx -l %PROJECT_NAME%.jtl'
			}
		}
		stage('Reports') {
			steps{
				perfReport filterRegex: '', relativeFailedThresholdNegative: 1.2, relativeFailedThresholdPositive: 1.89, relativeUnstableThresholdNegative: 1.8, relativeUnstableThresholdPositive: 1.5, sourceDataFiles: '%PROJECT_NAME%.jtl'
			}
		}
	}
}